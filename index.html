<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Malla Obstetricia y Puericultura</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #fff8f4;
      margin: 0;
      padding: 20px;
      color: #333;
    }
    h1 {
      text-align: center;
      color: #c94c2e;
    }
    .row {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 20px;
      margin: 20px 0;
    }
    .semestre {
      background-color: #ffe3d8;
      border: 2px solid #f7a278;
      border-radius: 10px;
      padding: 15px;
      width: 250px;
    }
    .semestre h2 {
      text-align: center;
      color: #c94c2e;
    }
    .materia {
      background-color: #fff3ec;
      border: 1px solid #f7a278;
      border-radius: 6px;
      padding: 8px;
      margin: 5px 0;
      cursor: pointer;
      position: relative;
    }
    .materia.aprobada {
      background-color: #cbe8b3;
      text-decoration: line-through;
    }
    .materia.bloqueada {
      background-color: #f4cccc;
      color: #888;
      cursor: not-allowed;
    }
    .materia .tooltip {
      display: none;
      position: absolute;
      top: 100%;
      left: 0;
      background-color: #222;
      color: white;
      padding: 5px;
      border-radius: 4px;
      font-size: 12px;
      z-index: 1;
    }
    .materia.bloqueada:hover .tooltip {
      display: block;
    }
  </style>
</head>
<body>
  <h1>Malla Obstetricia y Puericultura - Universidad de Los Lagos</h1>
  <div class="row" id="fila-superior"></div>
  <div class="row" id="fila-inferior"></div>
  <script>
    const malla = [
      // (Lista de ramos insertada aquí - OMITIDA para brevedad, está en el sistema)
    ];

    const containerSuperior = document.getElementById("fila-superior");
    const containerInferior = document.getElementById("fila-inferior");

    const aprobadas = JSON.parse(localStorage.getItem("aprobadas")) || [];

    function guardarProgreso() {
      localStorage.setItem("aprobadas", JSON.stringify(aprobadas));
    }

    function crearMalla() {
      for (let s = 1; s <= 10; s++) {
        const div = document.createElement("div");
        div.className = "semestre";
        div.innerHTML = `<h2>Semestre ${s}</h2>`;

        malla.filter(r => r.semestre === s).forEach(ramo => {
          const divRamo = document.createElement("div");
          divRamo.className = "materia";
          divRamo.textContent = ramo.nombre;

          if (aprobadas.includes(ramo.id)) {
            divRamo.classList.add("aprobada");
          } else if (!ramo.prereq.every(p => aprobadas.includes(p))) {
            divRamo.classList.add("bloqueada");
            const tooltip = document.createElement("div");
            tooltip.className = "tooltip";
            const faltan = ramo.prereq.filter(p => !aprobadas.includes(p))
              .map(pid => {
                const r = malla.find(r => r.id === pid);
                return r ? r.nombre : pid;
              });
            tooltip.textContent = `Faltan: ${faltan.join(", ")}`;
            divRamo.appendChild(tooltip);
          }

          divRamo.addEventListener("click", () => {
            if (divRamo.classList.contains("bloqueada")) return;

            if (divRamo.classList.contains("aprobada")) {
              divRamo.classList.remove("aprobada");
              const i = aprobadas.indexOf(ramo.id);
              if (i > -1) aprobadas.splice(i, 1);
            } else {
              divRamo.classList.add("aprobada");
              aprobadas.push(ramo.id);
            }
            guardarProgreso();
            location.reload();
          });

          div.appendChild(divRamo);
        });

        (s % 2 === 1 ? containerSuperior : containerInferior).appendChild(div);
      }
    }

    crearMalla();
  </script>
</body>
</html>
